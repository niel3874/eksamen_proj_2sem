---
import Layout from "../layouts/Layout.astro";
import Header from "../components/Header.astro";
import ProductList from "../components/ProductList.astro";
import { getAllProducts } from "../scripts/products.js";
import Footer from "../components/Footer.astro";



// Explicitly define the type of `products` as an array of objects
let products: { id: number; name: string; image_url: string; [key: string]: any }[] = [];

async function fetchProducts() {
  try {
    console.log("Fetching products for Product List...");
    const allProducts = (await getAllProducts()) || [];
    // Ensure the type is consistent by filtering the products correctly
    products = allProducts.filter((product: { id: number }) => product.id >= 1 && product.id <= 9);
  } catch (error: unknown) {
    console.error("Error fetching products:", (error as Error).message);
  }
}

await fetchProducts();
---

<html lang="da">
  <head>
    <meta charset="UTF-8" />
    <title>Produkter</title>
    <link rel="stylesheet" href="/styles/global.css" />
  </head>
  <body class="black-background">
    <Header />
    <main>
      <h1 class="category-title">Produkter</h1>
      {products.length > 0 ? (
        <ProductList products={products} />
      ) : (
        <p class="no-products">Ingen produkter tilg√¶ngelige.</p>
      )}
    </main>
    <Footer />
  </body>
</html>

<style>
  .black-background {
    background-color: black;
    color: white;
    margin: 0;
    font-family: "Exo", sans-serif;
  }

  .category-title {
    font-family: "Orbitron", sans-serif;
    color: #c69cdb; /* Purple */
    text-align: center;
    font-size: 2rem;
    margin-bottom: 2rem;
  }

  .no-products {
    color: red;
    text-align: center;
  }
</style>
